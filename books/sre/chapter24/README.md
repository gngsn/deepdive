# CHAPTER 24. Distributed Periodic Scheduling with Cron

<i><small>크론을 이용한 분산된 주기적 스케줄링</small></i>


## Cron

**크론(Cron)**: 사용자가 지정한 시간이나 간격에 따라 정기적으로 작업을 실행하도록 만들어진 유닉스(Unix) 유틸리티

### Introduction

- **Crontab**: 가장 일반적인 시간 표기법
- **`crond`**: 크론 스케줄들을 로드하고 지정된 시간이 되면 실행하는 데몬.

### Reliability Perspective

<i><small>신뢰성 관점에서의 크론</small></i>

**장애 도메인**: 단일 실패 지점을 공유하는 하드웨어 구성 요소 집합

- **크론의 Failure Domain**: 단 하나의 머신
- **크론의 실패 도메인**: 하나의 머신
  - 머신이 작동하지 않으면 크론 스케줄러나 작업이 실행되지 않음
  - 가령, 크론 스케줄러가 다른 작업 머신에서 작업을 실행하는 경우(e.g. SSH 사용), '스케줄러 머신'과 '실제 작업 수행 머신' 이라는 두 개의 실패 도메인 존재
- `crond` 혹은 머신 재시작 시, **crontab 설정**만 지속되면 됨
  - **fire-and-forget** 방식으로 작업을 실행 → 크론 실행은 한번 수행 후 추적하지 않음
- `anacron`은 예외. 
  - 시스템 다운 시, 실행되었어야 할 작업 중 **일일 또는 그보다 적은 빈도의 작업만을 재실행**함. 
  - 워크스테이션과 노트북의 유지보수 작업에 매우 유용하며, 마지막 실행 타임스탬프를 저장하는 파일로 관리됨


### Cron Jobs and Idempotency

<i><small>크론 작업과 멱등성</small></i>


가비지컬렉션프로세스같은일부크론작업은멱등성을가짐
오동작을수행하 더라도이런작업을여러번실행하는것은안전
하지만여러사용자에게이메일뉴스레 터를발송하는프로세스를 크론작업으로실행하는것은한번이상실행되어서는안된다

보통은 작업을 수행함으로써위험을 가중시키는 대신 작업의실행을건너뛰는 편을택한다. 
그이유는건너뛰었던작업을복구하는것이두번실행된작업을복구하는 것보다수월하기때문

우리는시스템이잘못된상태가되는 것보다는' 변경없이실패(aildosea)하는방식을더선

## Cron at Large Scale

대 용 량 시 스 템 내 에 서 의 크론

### Extended Infrastructure

인프라스트럭처의 확장

- 기본적으로 크론은 단일 머신으로 제한
- 단일 머신에 크론 서비스를 호스팅하면 신뢰성 측면에서 **재앙** 가능성이 있음
- 신뢰성을 높이기 위해 프로세스를 머신에서 분리
- **데이터센터 스케줄링 시스템이 서비스를 배포할 머신을 결정하고 머신 장애를 처리함**
- 머신 재배치는 로컬 상태 손실 및 서비스 재배치 시간 초과 문제를 일으킬 수 있음
- 데이터 손실을 방지하기 위해 분산 파일 시스템 사용, 시간이 중요한 작업의 경우 **Hot Spares** 이용
  - 빠르게 작업을 재개할 수 있고, 작업을 다시 예약 하는 시간을 획기적으로 줄일 수 있음 


### Extended Requirements

요구사항의확장

- 단일 머신 시스템은 제한된 격리 환경에서 모든 프로세스가 실행됨
- 데이터센터 규모 배포는 격리를 강화하기 위해 컨테이너 사용
- 데이터센터 자원 부족 시 크론 작업 지연 가능성 존재, 자원 요구사항 추적 필요
- 특정 머신에서 프로세스 실행을 분리하면 부분 실행 실패 위험 증가
- 새 크론 작업 배포 시 다중 RPC 필요할 수 있음, 일부 RPC 실패에 대한 복구 절차 필요
- 데이터센터는 단일 머신보다 복잡한 생태계, 부분적인 데이터센터 장애 시에도 서비스가 작동하도록 보장 필요
- 크론 서비스를 다양한 위치에 배치하여 단일 전력 분배 장치의 실패로 인한 전체 서비스 중단 방지
- 전 세계적으로 단일 크론 서비스 배포 가능하지만, 단일 데이터센터 내 배포는 낮은 지연 시간 및 데이터센터 스케줄러와 운명을 공유하는 장점 있음

## Building Cron at Google
### Tracking the State of Cron Jobs
### The Use of Paxos
### The Roles of the Leader and the Follower
### Storing the State
### Running Large Cron

## Summary
```