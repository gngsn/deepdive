# Transit Gateway Peering

여러개의 VPCs를 연결하기 위해서 VPC Peering을 사용했던 것처럼,
Transit Gateway도 동일하게 Transit Gateway Peering 을 사용할 수 있음

- Transit Gateway는 지역 라우터로, 동일 리전의 여러 VPC를 연결
- 다른 리전 간 네트워크 연결을 위해, Transit Gateway를 다른 리전의 Transit Gateway와 피어링할 수 있음
  - 그래서 두 Transit Gateway 사이에 Private Connectivity를 생성해야함
- 피어링 연결을 위해 반드시 '정적' 라우트를 추가해야 함
  - **BGP 미지원**: BGP 라우팅 설정(경로를 한 라우터에서 다른 라우터로 동적으로 교환)이 활성화되어 있으면 안됨
- 지역 간 트래픽은 암호화되며, AWS 글로벌 네트워크를 통해 전송되고 Public 인터넷에 노출되지 않음. 최대 50Gbps의 대역폭 지원.
- 가능하다면, 피어링된 Transit Gateway에 대해 가능한 고유한 ASN(자율 시스템 번호)을 사용하는 것이 좋음.

<br>

### For example

아래와 같이 `us-east-1` 과 `eu-central-1` 리전 간의 연결을 한다고 가정


```
      +------------------   Region   -----------------+             +------------------   Region   -----------------+
      |                                    us-east-1  |             |  eu-central-1                                 |
      |   +----- VPC -----+                           |             |                           +----- VPC -----+   |
      |   |               |             64512         |             |         64513             |               |   |
      |   |  10.1.0.0/16  +---+    +---- TGW ----+    |             |    +---- TGW ----+   +----+  10.3.0.0/16  |   |
      |   |               |   |    |             |    |             |    |             |   |    |               |   |
      |   +---------------+   +----+             +====+=============+====+             +---+    +---------------+   |
      |                            |             |    |             |    |             |                            |
      |   +----- VPC -----+   +----+             |    |             |    |             +---+   +----- VPC ------+   |
      |   |               |   |    |             |    |             |    |             |   |   |                |   |
      |   |  10.2.0.0/16  +---+    +-------------+    |             |    +-------------+   +---+ 192.168.0.0/16 |   |
      |   |               |                           |             |                          |                |   |
      |   +---------------+                           |             |                          +----------------+   |
      |                                               |             |                                               |
      +-----------------------------------------------+             +-----------------------------------------------+
```

이 때, 모든 연결성(Full Connectivity)을 위해 Transit Gateway에 Route Table 설정을 해줘야 함

```
      +------------------   Region   -----------------+             +------------------   Region   -----------------+
      |                                    us-east-1  |             |  eu-central-1                                 |
      |   +----- VPC -----+                           |             |                           +----- VPC -----+   |
      |   |               |             64512         |             |         64513             |               |   |
      |   |  10.1.0.0/16  +---+    +---- TGW ----+    |             |    +---- TGW ----+   +----+  10.3.0.0/16  |   |
      |   |               |   |    |             |    |             |    |             |   |    |               |   |
      |   +---------------+   +----+             +====+=============+====+             +---+    +---------------+   |
      |                            |             |    |             |    |             |                            |
      |   +----- VPC -----+   +----+             |    |             |    |             +---+   +------ VPC -----+   |
      |   |               |   |    |             |    |             |    |             |   |   |                |   |
      |   |  10.2.0.0/16  +---+    +-------------+    |             |    +-------------+   +---+ 192.168.0.0/16 |   |
      |   |               |                           |             |                          |                |   |
      |   +---------------+                           |             |                          +----------------+   |
      |                                               |             |                                               |
      +-----------------------------------------------+             +-----------------------------------------------+

                               Main Route Table              
  +----------------+--------------------+------------+       
  | Destination    | Target             | Type       |       
  |----------------+--------------------+------------+       
  | 10.1.0.0/16    | VPC-A-Att-ID       | Propagated |   
  | 10.2.0.0/16    | VPC-B-Att-ID       | Propagated |  
  | 10.3.0.0/16    | TGW-Peering-Att-ID | Static     |  
  | 192.168.0.0/16 | TGW-Peering-Att-ID | Static     |  
  +----------------+--------------------+------------+  
```

VPCs 연결을 위한 (`10.1.0.0/16`, `VPC-A-Att-ID`, `Propagated`), (`10.2.0.0/16`, `VPC-B-Att-ID`, `Propagated`) 레코드   

VPC C 연결을 위해 (`10.3.0.0/16`, `TGW-Peering-Att-ID`, `Static`) 레코드 추가

→ Peering을 한다고 해서 레코드가 전파되진 않음. 반드시 추가 설정을 해주어야 함

비슷하게, Corporate data center 연결을 위해 (`192.168.0.0/16`, `TGW-Peering-Att-ID`, `Static`) 레코드 추가

`eu-central-1` 라우터에도 설정 추가

```
      +------------------   Region   -----------------+             +------------------   Region   -----------------+
      |                                    us-east-1  |             |  eu-central-1                                 |
      |   +----- VPC -----+                           |             |                           +----- VPC -----+   |
      |   |               |             64512         |             |         64513             |               |   |
      |   |  10.1.0.0/16  +---+    +---- TGW ----+    |             |    +---- TGW ----+   +----+  10.3.0.0/16  |   |
      |   |               |   |    |             |    |             |    |             |   |    |               |   |
      |   +---------------+   +----+             +====+=============+====+             +---+    +---------------+   |
      |                            |             |    |             |    |             |                            |
      |   +----- VPC -----+   +----+             |    |             |    |             +---+   +------ VPC -----+   |
      |   |               |   |    |             |    |             |    |             |   |   |                |   |
      |   |  10.2.0.0/16  +---+    +-------------+    |             |    +-------------+   +---+ 192.168.0.0/16 |   |
      |   |               |                           |             |                          |                |   |
      |   +---------------+                           |             |                          +----------------+   |
      |                                               |             |                                               |
      +-----------------------------------------------+             +-----------------------------------------------+

                               Main Route Table                               Main Route Table
  +----------------+--------------------+------------+              +----------------+--------------------+------------+
  | Destination    | Target             | Type       |              | Destination    | Target             | Type       |
  |----------------+--------------------+------------+              |----------------+--------------------+------------+
  | 10.1.0.0/16    | VPC-A-Att-ID       | Propagated |              | 10.3.0.0/16    | VPC-C-Att-ID       | Propagated |
  | 10.2.0.0/16    | VPC-B-Att-ID       | Propagated |              | 192.168.0.0/16 | VPN-Connection     | Propagated |
  | 10.3.0.0/16    | TGW-Peering-Att-ID | Static     |              | 10.1.0.0/16    | TGW-Peering-Att-ID | Static     |
  | 192.168.0.0/16 | TGW-Peering-Att-ID | Static     |              | 10.2.0.0/16    | TGW-Peering-Att-ID | Static     |
  +----------------+--------------------+------------+              +----------------+--------------------+------------+
```



